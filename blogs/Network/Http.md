---
title: Http
date: 2023-10-06
tags:
  - Network
categories:
  - Network
---

## HTTP1.0 和 HTTP2.0 的区别

- 二进制协议：1.0 的解析是基于文本，2.0 使用二进制；将请求和响应分割为更小的帧，实现多路复用
- 多路复用：在一个连接中，客户端和服务端可以同时发送多个请求和响应，不用按照顺序一个一个发送，避免了 HTTP 队头阻塞问题
  - TP 队头阻塞：是指在同一域名下浏览器的连接数有限制，并且请求要在连接内按顺序处理，这样就会导致某个请求的延迟或阻塞会影响后续请求的处理。但 Tcp 队头阻塞仍然存在
  - TCP 队头阻塞：为了保证**数据包的有序传输**，如果一个数据包在丢失损坏后，`TCP`接受端会要求重新发送该数据包，直到被正确接收为止。）
- 头部信息压缩：1.0 每次请求都会带上所有信息，2.0 引入头部压缩，将头部信息使用 gzip 压缩后发送，节省性能。同时客户端和服务端共同维护一张头部信息表，届时发送索引即可知道字段信息
- 服务端推送：2.0 允许服务器向客户端主动发送资源。

## HTTP 和 HTTPS 协议的区别

- HTTPS 需要 CA 证书，HTTP 不需要
- HTTP 是不安全的明文传输，HTTPS 是基于 SSL 加密的安全传输
- HTTP 端口是 80，HTTPS 是 443

## HTTP 请求中的 Keep-alive

​		1.0 中每次请求响应建立连接，完成后立即断开是**短连接；**是一种**长连接**在请求完成后保持连接减少服务器请求压力。通过在请求头中添加**Connection: keep-alive**字段，在响应头中有该字段说明长连接已建立。在 1.0 中默认开启，2.0 使用多路复用机制后就取缔掉 Keep-alive 了

## 三次握手

​	指建立一个`TCP`连接时，需要客户端和服务器总共发送 3 个包，主要作用是为了确认双方接受和发放能力是否正常。

- ##### 字段理解：

  - seq：`序列号`随机数 seq=x 每次连接都会携带一个自己的随机序列号
  - ack：`确认号`ack=seq+1 确认上一次收到了序列号除了第一次连接都会携带
  - ACK：确认收到序列号 ACK=1 除了第一次连接都会携带
  - SYN：发起一个新连接 SYN=1
  - SYN：发起一个新连接 SYN=1
  - FIN：释放一个连接 FIN=1

- 初始化 客户端处在 closed 状态，服务端处于 listen 状态

  - 第一次握手：客户端向服务端发送请求连接报文
  - 第二次握手：服务器收到报文，向客户端发送回复报文，同意连接
  - 第三次握手：浏览器收到报文后回复服务器。收到同意连接报文。连接正式建立
  - 为什么需要第三次握手：为了确认双方的接收能力和发送能力都正常。服务端在发送完`SYN`报文后，客户端需要回复一个`ACK`告诉服务的确认有效。

## 四次握手

​	客户端断开连接

- 第一次握手：向服务器发送报文，我要断开连接了
- 第二次握手：服务器收到报文后，开始处理未完成事物
- 第三次握手：服务器向客户端发送报文，我处理好了
- 第四次握手：客户端收到服务器报文后，回复服务器 OK

**为什么是四次** 客户端发送`FIN`报文后，表示客户端当前没有数据需要处理，而不代表服务端没有数据需要处理。此时需要服务端回复`ACK`确认收到报文后，开始处理内部数据。当内部数据处理完后，再回复`FIN`可以关闭连接

## 浏览器输入 URL 回车后处理

- URL 解析：头部啊 端口啊 域名啊补充完整
- 缓存判断：判断本地是否有请求资源的缓存，这样就可以不用向服务器请求
- DNS 解析：通过域名获取服务器 IP 地址
- 建立连接：三次握手
- 发送请求
- 服务器处理返回数据
- 浏览器渲染页面
- 关闭连接：四次握手

## HTTPS 加密过程

使用混合加密方式即对称加密加非对称加密

- 服务端传递 CA 证书给客户端
- 客户端通过证书验证网站，拿到公钥 A
- 客户端对称加密生成密钥 B，用公钥 A 加密后返回给服务端
- 服务端拿私钥 A 解密公钥 A，拿到客户端给的密钥 B
- 后续通信就使用客户端给的密钥 B 进行加密

## HTTP 状态码

- 1xx：请求正在处理
- 2XX：正常状态
  - 200：请求处理成功
  - 201：请求成功服务器已创建新资源
  - 202：服务器已接收请求，但尚未处理
- 3xx：重定向状态
  - 301：请求重定向
  - 302：临时重定向
  - 303：临时重定向，使用 get 请求新的 URL
  - 304：浏览器缓存相关
- 4xx：错误状态
  - 400：请求格式服务器无法理解
  - 401：请求未授权
  - 403：禁止访问
  - 404：服务器上没有请求资源
- 5xx：服务器错误状态
  - 500：服务端错误
  - 503：服务器暂时无法处理请求

## 九种请求方式

![9种请求方式](https://cdn.jsdelivr.net/gh/kq981024/Media/202406141901105.png)